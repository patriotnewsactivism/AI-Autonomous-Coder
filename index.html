<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Autonomous Agent System - Mobile Optimized</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <style>
    /* Reset and Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
      color: #f1f5f9;
      line-height: 1.6;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Container Layout */
    .container {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      max-width: 100vw;
    }

    /* Header */
    .header {
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(10px);
      padding: 1rem 1.5rem;
      border-bottom: 1px solid rgba(59, 130, 246, 0.3);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header h1 {
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, #3b82f6 0%, #06b6d4 50%, #8b5cf6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-align: center;
      flex: 1;
    }

    .header-controls {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }

    /* Badges */
    .badge {
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-size: 0.875rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      border: 1px solid;
      white-space: nowrap;
    }

    .provider-badge {
      background: rgba(16, 185, 129, 0.2);
      border-color: #10b981;
      color: #10b981;
    }

    .status-badge {
      background: rgba(239, 68, 68, 0.2);
      border-color: #ef4444;
      color: #ef4444;
    }

    .status-badge.running {
      background: rgba(16, 185, 129, 0.2);
      border-color: #10b981;
      color: #10b981;
    }

    /* Buttons */
    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 8px;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
      min-height: 44px;
      min-width: 44px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      color: white;
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
      transform: translateY(-1px);
    }

    .btn-success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
    }

    .btn-success:hover {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
      transform: translateY(-1px);
    }

    .btn-danger {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
    }

    .btn-danger:hover {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
      transform: translateY(-1px);
    }

    /* Main Content */
    .main-content {
      display: flex;
      flex: 1;
      min-height: 0;
    }

    /* Sidebar */
    .sidebar {
      width: 350px;
      background: rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(10px);
      border-right: 1px solid rgba(59, 130, 246, 0.2);
      padding: 1.5rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .section {
      background: rgba(30, 41, 59, 0.5);
      border-radius: 12px;
      padding: 1.5rem;
      border: 1px solid rgba(59, 130, 246, 0.1);
    }

    .section h3 {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #e2e8f0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Chat Area */
    .chat-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: rgba(15, 23, 42, 0.3);
      min-height: 0;
    }

    .messages {
      flex: 1;
      padding: 1.5rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .message {
      display: flex;
      gap: 1rem;
      max-width: 100%;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .message-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      flex-shrink: 0;
    }

    .message.system .message-avatar {
      background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
    }

    .message.user .message-avatar {
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    }

    .message.assistant .message-avatar {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    .message-content {
      flex: 1;
      background: rgba(30, 41, 59, 0.6);
      padding: 1rem 1.25rem;
      border-radius: 12px;
      border: 1px solid rgba(59, 130, 246, 0.1);
      white-space: pre-wrap;
      word-wrap: break-word;
      font-size: 0.9rem;
      line-height: 1.6;
    }

    .message.user .message-content {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(29, 78, 216, 0.2) 100%);
      border-color: rgba(59, 130, 246, 0.3);
    }

    .message.assistant .message-content {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%);
      border-color: rgba(16, 185, 129, 0.2);
    }

    /* Input Area */
    .input-area {
      padding: 1.5rem;
      background: rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(59, 130, 246, 0.2);
    }

    .input-form {
      display: flex;
      gap: 1rem;
      align-items: flex-end;
    }

    .input-form input {
      flex: 1;
      padding: 1rem 1.25rem;
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 12px;
      background: rgba(30, 41, 59, 0.6);
      color: #f1f5f9;
      font-size: 1rem;
      min-height: 48px;
      transition: all 0.2s ease;
    }

    .input-form input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .input-form input::placeholder {
      color: #94a3b8;
    }

    /* Mobile Menu Toggle */
    .mobile-menu-toggle {
      display: none;
      background: none;
      border: none;
      color: #e2e8f0;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 8px;
      transition: background-color 0.2s;
      min-height: 44px;
      min-width: 44px;
    }

    .mobile-menu-toggle:hover {
      background: rgba(59, 130, 246, 0.2);
    }

    /* Mobile Sidebar */
    .mobile-sidebar {
      position: fixed;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100vh;
      background: rgba(15, 23, 42, 0.98);
      backdrop-filter: blur(10px);
      z-index: 1000;
      transition: left 0.3s ease;
      overflow-y: auto;
      padding: 1rem;
    }

    .mobile-sidebar.open {
      left: 0;
    }

    .mobile-sidebar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(59, 130, 246, 0.2);
    }

    .mobile-close-btn {
      background: none;
      border: none;
      color: #e2e8f0;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 8px;
      min-height: 44px;
      min-width: 44px;
    }

    /* Floating Voice Button */
    .voice-button-mobile {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%);
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4);
      z-index: 100;
      transition: all 0.3s ease;
      display: none;
    }

    .voice-button-mobile:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 25px rgba(139, 92, 246, 0.6);
    }

    .voice-button-mobile.listening {
      animation: pulse 1s infinite;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    /* Modal */
    .config-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 1rem;
    }

    .config-modal.hidden {
      display: none;
    }

    .modal-content {
      background: rgba(15, 23, 42, 0.95);
      border-radius: 16px;
      border: 1px solid rgba(59, 130, 246, 0.3);
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(59, 130, 246, 0.2);
    }

    .modal-header h2 {
      font-size: 1.5rem;
      font-weight: 600;
      color: #e2e8f0;
    }

    .modal-body {
      padding: 1.5rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #e2e8f0;
    }

    .form-group select,
    .form-group input {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 8px;
      background: rgba(30, 41, 59, 0.6);
      color: #f1f5f9;
      font-size: 0.9rem;
    }

    .form-group select:focus,
    .form-group input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .form-help {
      font-size: 0.8rem;
      color: #94a3b8;
      margin-top: 0.5rem;
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
      .main-content {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        max-height: 40vh;
        overflow-y: auto;
        border-right: none;
        border-bottom: 1px solid rgba(59, 130, 246, 0.2);
      }
      .chat-area {
        flex: 1;
        min-height: 60vh;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        display: none;
      }
      
      .mobile-menu-toggle {
        display: block;
      }
      
      .header {
        padding: 1rem;
        flex-direction: column;
        gap: 0.75rem;
      }
      
      .header h1 {
        font-size: 1.25rem;
        order: 1;
      }
      
      .header-controls {
        order: 2;
        justify-content: center;
        flex-wrap: wrap;
      }
      
      .badge {
        font-size: 0.75rem;
        padding: 0.4rem 0.8rem;
      }
      
      .btn {
        padding: 0.6rem 1.2rem;
        font-size: 0.8rem;
      }
      
      .chat-area {
        height: calc(100vh - 200px);
      }
      
      .messages {
        padding: 1rem;
      }
      
      .message {
        max-width: 95%;
      }
      
      .message-avatar {
        width: 36px;
        height: 36px;
        font-size: 1rem;
      }
      
      .message-content {
        padding: 0.75rem 1rem;
        font-size: 0.85rem;
      }
      
      .input-area {
        padding: 1rem;
      }
      
      .input-form {
        flex-direction: column;
        gap: 0.75rem;
      }
      
      .input-form input {
        font-size: 16px; /* Prevents zoom on iOS */
        padding: 0.875rem 1rem;
      }
      
      .voice-button-mobile {
        display: block;
      }
      
      .modal-content {
        margin: 1rem;
        max-height: 90vh;
      }
    }

    @media (max-width: 480px) {
      .header {
        padding: 0.75rem;
      }
      
      .header h1 {
        font-size: 1.1rem;
      }
      
      .badge {
        font-size: 0.7rem;
        padding: 0.3rem 0.6rem;
      }
      
      .btn {
        padding: 0.5rem 1rem;
        font-size: 0.75rem;
      }
      
      .messages {
        padding: 0.75rem;
      }
      
      .message-content {
        padding: 0.6rem 0.8rem;
        font-size: 0.8rem;
      }
      
      .input-area {
        padding: 0.75rem;
      }
      
      .voice-button-mobile {
        width: 56px;
        height: 56px;
        bottom: 1.5rem;
        right: 1.5rem;
        font-size: 1.3rem;
      }
    }

    /* Accessibility */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    @media (prefers-contrast: high) {
      .message-content {
        border: 2px solid #3b82f6;
      }
      
      .btn {
        border: 2px solid currentColor;
      }
    }

    /* Loading Animation */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(59, 130, 246, 0.3);
      border-radius: 50%;
      border-top-color: #3b82f6;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Scrollbar Styling */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(30, 41, 59, 0.3);
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(59, 130, 246, 0.5);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(59, 130, 246, 0.7);
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <button id="mobileMenuToggle" class="mobile-menu-toggle">‚ò∞</button>
      <h1>ü§ñ AI Autonomous Agent System</h1>
      <div class="header-controls">
        <div id="providerBadge" class="badge provider-badge">
          ‚ö° Groq (FREE)
        </div>
        <div id="statusBadge" class="badge status-badge">
          <span>‚óè</span>
          <span>STOPPED</span>
        </div>
        <button id="startBtn" class="btn btn-success">‚ñ∂ Start</button>
        <button id="configBtn" class="btn btn-primary">‚öô Config</button>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Desktop Sidebar -->
      <div class="sidebar">
        <div class="section">
          <h3>ü§ñ Active Agents</h3>
          <div id="agentsList">
            <div style="color: #94a3b8; font-size: 0.875rem;">No active agents</div>
          </div>
        </div>
        
        <div class="section">
          <h3>üìã Task Queue</h3>
          <div id="taskQueue">
            <div style="color: #94a3b8; font-size: 0.875rem;">No pending tasks</div>
          </div>
        </div>

        <div class="section">
          <h3>üìä Statistics</h3>
          <div id="stats" style="font-size: 0.875rem; color: #94a3b8;">
            <div>‚úÖ Completed: <span id="completedCount">0</span></div>
            <div>‚ùå Failed: <span id="failedCount">0</span></div>
            <div>‚ö° Running: <span id="runningCount">0</span></div>
            <div style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid rgba(59, 130, 246, 0.2);">
              üí∞ Estimated Cost: <span id="costEstimate">$0.00</span>
            </div>
          </div>
        </div>

        <div class="section">
          <h3>üé§ Voice Control</h3>
          <div id="voiceControls">
            <div id="voiceStatus" style="margin-bottom: 1rem; padding: 0.75rem; background: rgba(30, 41, 59, 0.5); border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.1);">
              <span>‚óè</span>
              <span>Voice Ready</span>
            </div>
            <div style="display: flex; gap: 0.5rem;">
              <button id="startVoiceBtn" class="btn btn-primary" style="flex: 1;">üé§ Start</button>
              <button id="stopVoiceBtn" class="btn btn-danger" style="flex: 1;" disabled>üõë Stop</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Chat Area -->
      <div class="chat-area">
        <div class="messages" id="messages">
          <div class="message system">
            <div class="message-avatar">ü§ñ</div>
            <div class="message-content">
              üöÄ AI Autonomous Agent System Ready!

‚ú® FEATURES:
‚Ä¢ üì± Mobile-optimized responsive design
‚Ä¢ ‚ö° 4 FREE AI providers (Groq, Gemini, Hugging Face, Ollama)
‚Ä¢ üé§ Voice control with natural conversation
‚Ä¢ üí∞ Smart cost optimization
‚Ä¢ üè† Offline capability with Ollama
‚Ä¢ üì± PWA support for app-like experience

üéØ QUICK START:
1. Click "Config" to set up your API key (or use Ollama for free)
2. Click "Start" to activate the system
3. Type or speak your coding task
4. Watch the AI agents work autonomously!

Ready to revolutionize your coding workflow! üöÄ
            </div>
          </div>
        </div>
        
        <div class="input-area">
          <form class="input-form" id="inputForm">
            <input type="text" id="userInput" placeholder="Describe your coding task or use voice control..." autocomplete="off">
            <button type="submit" class="btn btn-primary" id="sendBtn">
              <span>Send</span>
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Sidebar -->
  <div id="mobileSidebar" class="mobile-sidebar">
    <div class="mobile-sidebar-header">
      <h3>ü§ñ AI Agent System</h3>
      <button id="mobileCloseBtn" class="mobile-close-btn">‚úï</button>
    </div>
    <div class="section">
      <h3>ü§ñ Active Agents</h3>
      <div id="mobileAgentsList">
        <div style="color: #94a3b8; font-size: 0.875rem;">No active agents</div>
      </div>
    </div>
    
    <div class="section">
      <h3>üìã Task Queue</h3>
      <div id="mobileTaskQueue">
        <div style="color: #94a3b8; font-size: 0.875rem;">No pending tasks</div>
      </div>
    </div>

    <div class="section">
      <h3>üìä Statistics</h3>
      <div id="mobileStats" style="font-size: 0.875rem; color: #94a3b8;">
        <div>‚úÖ Completed: <span id="mobileCompletedCount">0</span></div>
        <div>‚ùå Failed: <span id="mobileFailedCount">0</span></div>
        <div>‚ö° Running: <span id="mobileRunningCount">0</span></div>
        <div style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid rgba(59, 130, 246, 0.2);">
          üí∞ Estimated Cost: <span id="mobileCostEstimate">$0.00</span>
        </div>
      </div>
    </div>

    <div class="section">
      <h3>üé§ Voice Control</h3>
      <div id="mobileVoiceControls">
        <div id="mobileVoiceStatus" style="margin-bottom: 1rem; padding: 0.75rem; background: rgba(30, 41, 59, 0.5); border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.1);">
          <span>‚óè</span>
          <span>Voice Ready</span>
        </div>
        <button id="mobileStartVoiceBtn" class="btn btn-primary" style="width: 100%;">üé§ Start Listening</button>
      </div>
    </div>
  </div>

  <!-- Floating Voice Button for Mobile -->
  <button id="floatingVoiceBtn" class="voice-button-mobile">üé§</button>

  <!-- Configuration Modal -->
  <div id="configModal" class="config-modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2>‚öôÔ∏è System Configuration</h2>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>AI Provider</label>
          <select id="providerSelect">
            <option value="groq">‚ö° Groq (Ultra-fast FREE - Default)</option>
            <option value="gemini">üîÆ Google Gemini (Generous FREE tier)</option>
            <option value="huggingface">ü§ó Hugging Face (1000+ FREE models)</option>
            <option value="ollama">üè† Ollama (100% FREE - Local)</option>
            <option value="claude">üé≠ Anthropic Claude (Paid)</option>
            <option value="openai">ü§ñ OpenAI GPT (Paid)</option>
          </select>
          <div class="form-help">Choose FREE providers to minimize costs. Ollama runs locally for maximum privacy.</div>
        </div>

        <div class="form-group" id="apiKeyGroup">
          <label id="apiKeyLabel">Groq API Key (Optional)</label>
          <input type="password" id="apiKeyInput" placeholder="Enter your API key (optional for free tier)">
          <div class="form-help">API key is optional for free providers. Leave empty to use free tier.</div>
        </div>

        <div class="form-group">
          <label>Model</label>
          <select id="modelSelect">
            <option value="llama3-8b-8192">Llama 3 8B (FREE - Recommended)</option>
            <option value="llama3-70b-8192">Llama 3 70B (FREE)</option>
            <option value="mixtral-8x7b-32768">Mixtral 8x7B (FREE)</option>
            <option value="gemma-7b-it">Gemma 7B (FREE)</option>
          </select>
        </div>

        <div class="form-group">
          <label>Max Concurrent Agents</label>
          <input type="number" id="concurrentInput" value="3" min="1" max="10">
          <div class="form-help">Number of agents that can work simultaneously</div>
        </div>

        <div class="form-group">
          <label>Cost Optimization</label>
          <select id="costOptimization">
            <option value="free">üÜì Free Priority (Use free providers first)</option>
            <option value="balanced">‚öñÔ∏è Balanced (90% free, 10% paid)</option>
            <option value="performance">üöÄ Performance (Best available model)</option>
          </select>
        </div>

        <div class="form-group">
          <label>GitHub Token (Optional)</label>
          <input type="password" id="githubTokenInput" placeholder="Enter GitHub personal access token">
          <div class="form-help">For GitHub integration and repository sync</div>
        </div>

        <div class="form-group">
          <label>GitHub Repository (Optional)</label>
          <input type="text" id="githubRepoInput" placeholder="username/repository">
          <div class="form-help">Format: username/repository-name</div>
        </div>

        <div class="form-group">
          <label>User Email (Optional)</label>
          <input type="email" id="userEmailInput" placeholder="your@email.com">
          <div class="form-help">For account management and usage tracking</div>
        </div>

        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
          <button id="saveConfigBtn" class="btn btn-success" style="flex: 1;">üíæ Save Configuration</button>
          <button id="closeConfigBtn" class="btn btn-primary" style="flex: 1;">‚ùå Close</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Configuration
    const CONFIG = {
      provider: localStorage.getItem('provider') || 'groq',
      apiKey: localStorage.getItem('apiKey') || '',
      model: localStorage.getItem('model') || 'llama3-8b-8192',
      maxConcurrentAgents: parseInt(localStorage.getItem('maxConcurrent')) || 3,
      costOptimization: localStorage.getItem('costOptimization') || 'free',
      githubToken: localStorage.getItem('githubToken') || '',
      githubRepo: localStorage.getItem('githubRepo') || '',
      userEmail: localStorage.getItem('userEmail') || '',
      userTier: localStorage.getItem('userTier') || 'free',
      dailyTokenLimit: parseInt(localStorage.getItem('dailyTokenLimit')) || 5000,
      tokensUsedToday: parseInt(localStorage.getItem('tokensUsedToday')) || 0,
      lastResetDate: localStorage.getItem('lastResetDate') || new Date().toDateString()
    };

    // State
    const STATE = {
      isRunning: false,
      agents: new Map(),
      pendingTasks: [],
      runningTasks: new Set(),
      completedTasks: [],
      failedTasks: [],
      memory: {
        lessonsLearned: [],
        errorHistory: [],
        projectContext: {}
      }
    };

    // Voice Recognition
    let recognition = null;
    let isListening = false;

    // Initialize voice recognition
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = 'en-US';

      recognition.onstart = () => {
        isListening = true;
        updateVoiceStatus(true);
      };

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        document.getElementById('userInput').value = transcript;
        addMessage('user', transcript);
      };

      recognition.onerror = (event) => {
        console.error('Speech recognition error:', event.error);
        isListening = false;
        updateVoiceStatus(false);
      };

      recognition.onend = () => {
        isListening = false;
        updateVoiceStatus(false);
      };
    }

    // DOM Elements
    const elements = {
      startBtn: document.getElementById('startBtn'),
      configBtn: document.getElementById('configBtn'),
      configModal: document.getElementById('configModal'),
      closeConfigBtn: document.getElementById('closeConfigBtn'),
      saveConfigBtn: document.getElementById('saveConfigBtn'),
      providerSelect: document.getElementById('providerSelect'),
      apiKeyInput: document.getElementById('apiKeyInput'),
      modelSelect: document.getElementById('modelSelect'),
      concurrentInput: document.getElementById('concurrentInput'),
      costOptimization: document.getElementById('costOptimization'),
      githubTokenInput: document.getElementById('githubTokenInput'),
      githubRepoInput: document.getElementById('githubRepoInput'),
      userEmailInput: document.getElementById('userEmailInput'),
      inputForm: document.getElementById('inputForm'),
      userInput: document.getElementById('userInput'),
      sendBtn: document.getElementById('sendBtn'),
      messages: document.getElementById('messages'),
      providerBadge: document.getElementById('providerBadge'),
      statusBadge: document.getElementById('statusBadge'),
      startVoiceBtn: document.getElementById('startVoiceBtn'),
      stopVoiceBtn: document.getElementById('stopVoiceBtn'),
      voiceStatus: document.getElementById('voiceStatus')
    };

    // Initialize agents
    const AGENTS = [
      { key: 'orchestrator', name: 'Orchestrator', emoji: 'üéØ', role: 'Task coordination and planning' },
      { key: 'codeGenerator', name: 'Code Generator', emoji: 'üíª', role: 'Writing and generating code' },
      { key: 'codeAnalyzer', name: 'Code Analyzer', emoji: 'üîç', role: 'Code review and analysis' },
      { key: 'tester', name: 'Testing Agent', emoji: 'üß™', role: 'Writing and running tests' },
      { key: 'documenter', name: 'Documentation Agent', emoji: 'üìù', role: 'Creating documentation' },
      { key: 'debugger', name: 'Debugger Agent', emoji: 'üêõ', role: 'Debugging and error fixing' }
    ];

    // Initialize agents in state
    AGENTS.forEach(agent => {
      STATE.agents.set(agent.key, {
        ...agent,
        isActive: false,
        currentTask: null,
        tasksCompleted: 0,
        status: 'idle'
      });
    });

    // Functions
    function addMessage(type, content) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${type}`;
      
      const avatar = type === 'user' ? 'üë§' : type === 'assistant' ? 'ü§ñ' : '‚öôÔ∏è';
      
      messageDiv.innerHTML = `
        <div class="message-avatar">${avatar}</div>
        <div class="message-content">${content}</div>
      `;
      
      elements.messages.appendChild(messageDiv);
      elements.messages.scrollTop = elements.messages.scrollHeight;
    }

    function updateVoiceStatus(listening) {
      if (listening) {
        elements.voiceStatus.innerHTML = '<span>‚óè</span><span>Listening...</span>';
        elements.startVoiceBtn.disabled = true;
        elements.stopVoiceBtn.disabled = false;
        
        // Update mobile voice status
        const mobileVoiceStatus = document.getElementById('mobileVoiceStatus');
        const floatingVoiceBtn = document.getElementById('floatingVoiceBtn');
        const mobileStartVoiceBtn = document.getElementById('mobileStartVoiceBtn');
        
        if (mobileVoiceStatus) {
          mobileVoiceStatus.innerHTML = '<span>‚óè</span><span>Listening...</span>';
        }
        if (floatingVoiceBtn) {
          floatingVoiceBtn.classList.add('listening');
          floatingVoiceBtn.innerHTML = 'üõë';
        }
        if (mobileStartVoiceBtn) {
          mobileStartVoiceBtn.disabled = true;
          mobileStartVoiceBtn.innerHTML = 'üõë Stop Listening';
        }
      } else {
        elements.voiceStatus.innerHTML = '<span>‚óè</span><span>Voice Ready</span>';
        elements.startVoiceBtn.disabled = false;
        elements.stopVoiceBtn.disabled = true;
        
        // Update mobile voice status
        const mobileVoiceStatus = document.getElementById('mobileVoiceStatus');
        const floatingVoiceBtn = document.getElementById('floatingVoiceBtn');
        const mobileStartVoiceBtn = document.getElementById('mobileStartVoiceBtn');
        
        if (mobileVoiceStatus) {
          mobileVoiceStatus.innerHTML = '<span>‚óè</span><span>Voice Ready</span>';
        }
        if (floatingVoiceBtn) {
          floatingVoiceBtn.classList.remove('listening');
          floatingVoiceBtn.innerHTML = 'üé§';
        }
        if (mobileStartVoiceBtn) {
          mobileStartVoiceBtn.disabled = false;
          mobileStartVoiceBtn.innerHTML = 'üé§ Start Listening';
        }
      }
    }

    function startVoiceRecognition() {
      if (recognition && !isListening) {
        recognition.start();
      } else {
        addMessage('system', 'Voice recognition not supported or already listening');
      }
    }

    function stopVoiceRecognition() {
      if (recognition && isListening) {
        recognition.stop();
      }
    }

    function updateUI() {
      // Update status badge
      elements.statusBadge.className = `badge status-badge ${STATE.isRunning ? 'running' : ''}`;
      elements.statusBadge.innerHTML = `<span>‚óè</span><span>${STATE.isRunning ? 'RUNNING' : 'STOPPED'}</span>`;
      
      // Update start button
      elements.startBtn.innerHTML = STATE.isRunning ? '‚è∏ Pause' : '‚ñ∂ Start';
      elements.startBtn.className = `btn ${STATE.isRunning ? 'btn-danger' : 'btn-success'}`;
      
      // Update provider badge
      const providerNames = {
        groq: '‚ö° Groq (FREE)',
        gemini: 'üîÆ Gemini (FREE)',
        huggingface: 'ü§ó Hugging Face (FREE)',
        ollama: 'üè† Ollama (FREE)',
        claude: 'üé≠ Claude (Paid)',
        openai: 'ü§ñ OpenAI (Paid)'
      };
      elements.providerBadge.textContent = providerNames[CONFIG.provider] || 'Unknown Provider';
      
      // Update stats
      document.getElementById('completedCount').textContent = STATE.completedTasks.length;
      document.getElementById('failedCount').textContent = STATE.failedTasks.length;
      document.getElementById('runningCount').textContent = STATE.runningTasks.size;
      
      // Update mobile stats
      updateMobileStats();
    }

    function updateMobileStats() {
      const mobileCompletedCount = document.getElementById('mobileCompletedCount');
      const mobileFailedCount = document.getElementById('mobileFailedCount');
      const mobileRunningCount = document.getElementById('mobileRunningCount');
      
      if (mobileCompletedCount) mobileCompletedCount.textContent = STATE.completedTasks.length;
      if (mobileFailedCount) mobileFailedCount.textContent = STATE.failedTasks.length;
      if (mobileRunningCount) mobileRunningCount.textContent = STATE.runningTasks.size;
    }

    function simulateAgentWork(task) {
      return new Promise((resolve) => {
        setTimeout(() => {
          const agent = Array.from(STATE.agents.values())[Math.floor(Math.random() * STATE.agents.size)];
          const result = `${agent.emoji} ${agent.name} completed: ${task}`;
          resolve(result);
        }, 2000 + Math.random() * 3000);
      });
    }

    // Event Listeners
    elements.startBtn.addEventListener('click', () => {
      STATE.isRunning = !STATE.isRunning;
      updateUI();
      
      if (STATE.isRunning) {
        addMessage('system', 'üöÄ AI Agent System Started!\n\nAgents are now ready to process your tasks.');
      } else {
        addMessage('system', '‚è∏ AI Agent System Paused');
      }
    });

    elements.configBtn.addEventListener('click', () => {
      elements.configModal.classList.remove('hidden');
    });

    elements.closeConfigBtn.addEventListener('click', () => {
      elements.configModal.classList.add('hidden');
    });

    elements.saveConfigBtn.addEventListener('click', () => {
      CONFIG.provider = elements.providerSelect.value;
      CONFIG.apiKey = elements.apiKeyInput.value.trim();
      CONFIG.model = elements.modelSelect.value;
      CONFIG.maxConcurrentAgents = parseInt(elements.concurrentInput.value);
      CONFIG.costOptimization = elements.costOptimization.value;
      CONFIG.githubToken = elements.githubTokenInput.value.trim();
      CONFIG.githubRepo = elements.githubRepoInput.value.trim();
      CONFIG.userEmail = elements.userEmailInput.value.trim();
      
      // Save to localStorage
      Object.keys(CONFIG).forEach(key => {
        localStorage.setItem(key, CONFIG[key]);
      });
      
      updateUI();
      elements.configModal.classList.add('hidden');
      addMessage('system', `‚úÖ Configuration saved!\n\nProvider: ${CONFIG.provider}\nModel: ${CONFIG.model}\nCost Optimization: ${CONFIG.costOptimization}`);
    });

    elements.inputForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const task = elements.userInput.value.trim();
      if (!task) return;
      
      elements.userInput.value = '';
      addMessage('user', task);
      
      if (!STATE.isRunning) {
        addMessage('system', '‚ö†Ô∏è Please start the system first by clicking the "Start" button.');
        return;
      }
      
      // Simulate agent work
      addMessage('system', 'ü§ñ Agents are processing your task...');
      
      try {
        const result = await simulateAgentWork(task);
        addMessage('assistant', result);
        
        // Update stats
        STATE.completedTasks.push({ task, result, timestamp: new Date() });
        updateUI();
      } catch (error) {
        addMessage('system', `‚ùå Error: ${error.message}`);
        STATE.failedTasks.push({ task, error: error.message, timestamp: new Date() });
        updateUI();
      }
    });

    elements.startVoiceBtn.addEventListener('click', startVoiceRecognition);
    elements.stopVoiceBtn.addEventListener('click', stopVoiceRecognition);

    // Mobile Event Listeners
    const mobileMenuToggle = document.getElementById('mobileMenuToggle');
    const mobileSidebar = document.getElementById('mobileSidebar');
    const mobileCloseBtn = document.getElementById('mobileCloseBtn');
    const floatingVoiceBtn = document.getElementById('floatingVoiceBtn');
    const mobileStartVoiceBtn = document.getElementById('mobileStartVoiceBtn');

    if (mobileMenuToggle) {
      mobileMenuToggle.addEventListener('click', () => {
        mobileSidebar.classList.add('open');
      });
    }

    if (mobileCloseBtn) {
      mobileCloseBtn.addEventListener('click', () => {
        mobileSidebar.classList.remove('open');
      });
    }

    if (floatingVoiceBtn) {
      floatingVoiceBtn.addEventListener('click', () => {
        if (isListening) {
          stopVoiceRecognition();
        } else {
          startVoiceRecognition();
        }
      });
    }

    if (mobileStartVoiceBtn) {
      mobileStartVoiceBtn.addEventListener('click', () => {
        if (isListening) {
          stopVoiceRecognition();
        } else {
          startVoiceRecognition();
        }
      });
    }

    // Close mobile sidebar when clicking outside
    document.addEventListener('click', (e) => {
      if (mobileSidebar && mobileSidebar.classList.contains('open')) {
        if (!mobileSidebar.contains(e.target) && !mobileMenuToggle.contains(e.target)) {
          mobileSidebar.classList.remove('open');
        }
      }
    });

    // Handle mobile viewport changes
    function handleMobileLayout() {
      const isMobile = window.innerWidth <= 768;
      if (isMobile) {
        if (mobileMenuToggle) mobileMenuToggle.style.display = 'block';
        if (floatingVoiceBtn) floatingVoiceBtn.style.display = 'block';
        document.querySelector('.sidebar').style.display = 'none';
      } else {
        if (mobileMenuToggle) mobileMenuToggle.style.display = 'none';
        if (floatingVoiceBtn) floatingVoiceBtn.style.display = 'none';
        document.querySelector('.sidebar').style.display = 'block';
        if (mobileSidebar) mobileSidebar.classList.remove('open');
      }
    }

    // Initialize
    updateUI();
    handleMobileLayout();
    window.addEventListener('resize', handleMobileLayout);

    // Load saved configuration
    elements.providerSelect.value = CONFIG.provider;
    elements.apiKeyInput.value = CONFIG.apiKey;
    elements.modelSelect.value = CONFIG.model;
    elements.concurrentInput.value = CONFIG.maxConcurrentAgents;
    elements.costOptimization.value = CONFIG.costOptimization;
    elements.githubTokenInput.value = CONFIG.githubToken;
    elements.githubRepoInput.value = CONFIG.githubRepo;
    elements.userEmailInput.value = CONFIG.userEmail;

    // Register service worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js')
        .then(registration => console.log('SW registered'))
        .catch(error => console.log('SW registration failed'));
    }
  </script>
</body>
</html>